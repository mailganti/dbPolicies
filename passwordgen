import random
import string
import argparse

def generate_password(length, include_digits, include_special):
    """Generates a random password based on specified criteria."""
    characters = string.ascii_letters
    if include_digits:
        characters += string.digits
    if include_special:
        characters += string.punctuation

    if not characters:
        raise ValueError("No character types selected for password generation.")

    password = ''.join(random.choice(characters) for _ in range(length))
    return password

def main():
    parser = argparse.ArgumentParser(description="Generate a strong, random password.")
    parser.add_argument("-l", "--length", type=int, default=12,
                        help="Desired length of the password (default: 12)")
    parser.add_argument("-d", "--digits", action="store_true",
                        help="Include digits in the password")
    parser.add_argument("-s", "--special", action="store_true",
                        help="Include special characters in the password")

    args = parser.parse_args()

    try:
        password = generate_password(args.length, args.digits, args.special)
        print(f"Generated Password: {password}")
    except ValueError as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    main()




















#!/usr/bin/env python3
import secrets
import string
import argparse
import sys

def generate_secure_password(length=16, use_uppercase=True, use_digits=True, 
                           use_special=True, include_special="", exclude_special="",
                           min_uppercase=1, min_digits=1, min_special=1):
    """
    Generate a cryptographically secure random password with custom special character options
    """
    if length < (min_uppercase + min_digits + min_special):
        raise ValueError("Password length too short for minimum requirements")
    
    password = []
    
    # Add required uppercase letters
    if use_uppercase:
        password.extend(secrets.choice(string.ascii_uppercase) 
                       for _ in range(min_uppercase))
    
    # Add required digits
    if use_digits:
        password.extend(secrets.choice(string.digits) 
                       for _ in range(min_digits))
    
    # Build special character pool
    special_pool = ""
    if use_special:
        if include_special:
            # Use only included special characters
            special_pool = include_special
        else:
            # Use all punctuation except excluded characters
            special_pool = string.punctuation
            if exclude_special:
                special_pool = ''.join(c for c in special_pool if c not in exclude_special)
        
        # Add required special characters if pool is not empty
        if special_pool:
            password.extend(secrets.choice(special_pool) 
                           for _ in range(min_special))
        elif min_special > 0:
            raise ValueError("No special characters available after filtering")
    
    # Build character pool for remaining positions
    char_pool = string.ascii_lowercase
    if use_uppercase:
        char_pool += string.ascii_uppercase
    if use_digits:
        char_pool += string.digits
    if use_special and special_pool:
        char_pool += special_pool
    
    if not char_pool:
        raise ValueError("No character types selected for password generation")
    
    # Fill remaining positions
    remaining_length = length - len(password)
    password.extend(secrets.choice(char_pool) for _ in range(remaining_length))
    
    # Shuffle the password
    secrets.SystemRandom().shuffle(password)
    
    return ''.join(password)

def validate_special_chars(chars):
    """Validate that special characters are from the allowed set"""
    allowed = string.punctuation
    invalid_chars = [c for c in chars if c not in allowed]
    if invalid_chars:
        raise ValueError(f"Invalid special characters: {''.join(invalid_chars)}. "
                        f"Allowed: {string.punctuation}")
    return chars

def calculate_entropy(password):
    """Calculate password entropy in bits"""
    char_pool_size = 0
    if any(c in string.ascii_lowercase for c in password):
        char_pool_size += 26
    if any(c in string.ascii_uppercase for c in password):
        char_pool_size += 26
    if any(c in string.digits for c in password):
        char_pool_size += 10
    if any(c in string.punctuation for c in password):
        # Count actual special characters used
        special_count = len([c for c in password if c in string.punctuation])
        if special_count > 0:
            char_pool_size += 32  # approximate
    
    if char_pool_size == 0:
        return 0
    
    entropy = len(password) * (char_pool_size.bit_length() - 1)
    return entropy

def show_special_chars():
    """Display available special characters"""
    print("Available special characters:")
    print(f"  All: {string.punctuation}")
    print("\nCommon groups:")
    print(f"  Brackets: {''.join(c for c in string.punctuation if c in '[]{}()<>')}")
    print(f"  Math: {''.join(c for c in string.punctuation if c in '+-*/=^')}")
    print(f"  Punctuation: {''.join(c for c in string.punctuation if c in '.,:;!?')}")
    print(f"  Quotes: {''.join(c for c in string.punctuation if c in '\'\"`')}")
    print(f"  Special: {''.join(c for c in string.punctuation if c in '@#$%&_|~')}")

def main():
    parser = argparse.ArgumentParser(
        description='Generate cryptographically secure random passwords with custom special character options'
    )
    parser.add_argument('-l', '--length', type=int, default=16,
                       help='Password length (default: 16)')
    parser.add_argument('-n', '--number', type=int, default=1,
                       help='Number of passwords to generate (default: 1)')
    
    # Character type options
    parser.add_argument('--no-upper', action='store_true',
                       help='Exclude uppercase letters')
    parser.add_argument('--no-digits', action='store_true',
                       help='Exclude digits')
    parser.add_argument('--no-special', action='store_true',
                       help='Exclude all special characters')
    
    # Special character customization
    parser.add_argument('--include', type=str, default='',
                       help='Include only these special characters (e.g., "!@#$")')
    parser.add_argument('--exclude', type=str, default='',
                       help='Exclude these special characters (e.g., "{}[]")')
    
    # Minimum requirements
    parser.add_argument('--min-upper', type=int, default=1,
                       help='Minimum uppercase letters (default: 1)')
    parser.add_argument('--min-digits', type=int, default=1,
                       help='Minimum digits (default: 1)')
    parser.add_argument('--min-special', type=int, default=1,
                       help='Minimum special characters (default: 1)')
    
    # Additional options
    parser.add_argument('--entropy', action='store_true',
                       help='Show password entropy')
    parser.add_argument('--show-special', action='store_true',
                       help='Show available special characters and exit')
    
    args = parser.parse_args()
    
    if args.show_special:
        show_special_chars()
        sys.exit(0)
    
    # Validate special character arguments
    try:
        if args.include:
            args.include = validate_special_chars(args.include)
        if args.exclude:
            args.exclude = validate_special_chars(args.exclude)
    except ValueError as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)
    
    # Check for conflicting options
    if args.include and args.exclude:
        print("Warning: Both --include and --exclude specified. --include will take precedence.", 
              file=sys.stderr)
    
    if args.no_special and (args.include or args.exclude):
        print("Warning: --no-special specified with --include/--exclude. Special characters will be excluded.", 
              file=sys.stderr)
    
    try:
        for i in range(args.number):
            password = generate_secure_password(
                length=args.length,
                use_uppercase=not args.no_upper,
                use_digits=not args.no_digits,
                use_special=not args.no_special,
                include_special=args.include,
                exclude_special=args.exclude,
                min_uppercase=args.min_upper,
                min_digits=args.min_digits,
                min_special=args.min_special
            )
            print(password)
            
            if args.entropy:
                entropy = calculate_entropy(password)
                print(f"Entropy: ~{entropy} bits", file=sys.stderr)
                
    except ValueError as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)

if __name__ == '__main__':
    main()
